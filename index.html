<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Unlock the gimbal-lock</title>
    <meta name="author"   content="Earthman·Topraksoy·الترابي·土本">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">

    <!-- You must use a mobile device to view this page -->
    <script defer src="tilt-to-steer.js" onload="startReadingTilt(); startMetrics();"></script>
    <!-- Uncomment the following to be able to use the browser console on mobile devices -->
    <!-- <script src="third_party_js/eruda.min.js"></script> -->
    <!-- <script>eruda.init();</script> -->

    <style>
      div{width:270px; height: 42px; background-color: lightgrey; margin: 5px; font-size: 1.2rem; border-radius: 5px; padding: 3px;}
      main{position:fixed; top:50%; left:50%; width:100vmin; height:100vmin; transform: translate(-50%,-50%); overflow: visible;}
      @media (orientation:portrait) {  main{top:65vh;}  }
      @media (orientation:landscape) {  main{left:72vw;}  }
      nav{position: absolute; top:0px; left:0px; width:100vmin; height:100vmin; display: flex; align-items: center; justify-content: center;}
    </style>
  </head>
  <body>
    <main>
      <nav>
        <img src="png/steer.png" alt="https://speakworldlanguages.app" style="width:75vmin;">
      </nav>
      <nav id="rotate">
        <img src="png/steeer.png" alt="https://speakworldlanguages.app" style="width:75vmin;">
      </nav>
    </main>
    <div id="or7on">Not available</div>
    <div id="rawBeta">Not available</div>
    <div id="rawGamma">Not available</div>
    <div id="dev">Not available</div>
    <div id="steer">Not available</div>

    <!-- THE CODE -->
    <script>
    // window.addEventListener("load",startReadingTilt,{once:true}); // Start running tilt-to-steer.js // THROWS: Uncaught ReferenceError: startReadingTilt is not defined

    function handlePortraitOrLandscapeINLINE() {
      setTimeout(afterAnUnnoticableDelay,100); // This solves the wrong-firing-order issue on Samsung Browser.
      function afterAnUnnoticableDelay() {
        if (screen.orientation) { // Mainly for Android (as of 2021)
          document.getElementById('or7on').innerHTML = "Screen rotation:" + screen.orientation.angle; // Returns 0 or 90 or 270 or 180 // You'll need a div with ID: "or7on" to uncomment and test
        } else { // Mainly for iOS (as of 2021)
          document.getElementById('or7on').innerHTML = "Screen rotation:" + window.orientation; // Returns 0 or 90 or -90 or 180 // You'll need a div with ID: "or7on" to uncomment and test
        }
      }
    }
    handlePortraitOrLandscapeINLINE(); // Set for the first time
    window.addEventListener("resize",handlePortraitOrLandscapeINLINE); // Update when change happens

    // window.addEventListener("load",startMetrics,{once:true}); // Window load is too early
    function startMetrics() {
      window.addEventListener("deviceorientation",handleTiltINLINE);
    }

    function handleTiltINLINE(event) {
      document.getElementById('rawBeta').innerHTML = "raw beta:"+event.beta.toFixed(1); // Uncomment to test
      document.getElementById('rawGamma').innerHTML = "raw gamma:"+event.gamma.toFixed(1); // Uncomment to test

      document.getElementById('steer').innerHTML = "steer: "+steerDeg.toFixed(1); // Uncomment to test
      document.getElementById('rotate').style.transform = "rotate("+smoothSteerDeg.toFixed(1)+"deg)"; // Uncomment to test

      if (theDeviceIsRotated == "no") {
        document.getElementById('dev').innerHTML = "g-supressor:" + suppressionFromGamma.toFixed(2) + "<br>b-supressor:" + suppressionFromBeta.toFixed(2);
      } else if (theDeviceIsRotated == "upsideDown") {
        document.getElementById('dev').innerHTML = "g-supressor:" + suppressionFromGamma.toFixed(2) + "<br>b-supressor:" + suppressionFromBeta.toFixed(2);
      }
    }
    </script>
    <!-- END OF THE CODE -->
  </body>
</html>
